# mcmls: Malware Classifier using Classic Machine Learning Strategies

## Project Overview

The **mcmls** (read *m-seemless*) project explores the effectiveness of **classic machine learning methods** for classifying malware based on their **byteplot image representations**. Unlike deep learning approaches that rely on complex neural networks, **mcmls** applies well-established **non-deep learning techniques** to analyze the visual structure of malware samples.

Malware binaries are transformed into **grayscale or RGB byteplot images**, which serve as inputs for a variety of classical machine learning models. The goal is to determine whether traditional statistical learning techniques can achieve competitive performance in malware classification compared to deep learning-based solutions.

The following **machine learning models** are included in this study:

- **Logistic Regression**
- **Linear Discriminant Analysis (LDA)**
- **Quadratic Discriminant Analysis (QDA)**
- **Decision Trees**
- **AdaBoost**
- **Support Vector Machine (SVM)**
- **Gaussian Naïve Bayes**

These models are evaluated against different **dataset distributions** to assess their performance in various real-world scenarios.

---

## Notebook vs CLI

This project includes both:

1. **A Jupyter Notebook**:  
   Provides an initial analysis of classical machine learning methods applied to malware byteplot classification. The notebook allows interactive exploration and experimentation with different models and datasets.

2. **A Command-Line Interface (CLI) framework**:  
   Designed for scalability and efficient execution of experiments. The CLI provides a structured pipeline for:
   - **Training models** on different datasets
   - **Evaluating performance** using various metrics
   - **Comparing results** across classifiers and dataset types  

Given its **flexibility and automation**, the **CLI framework is the preferred tool** for large-scale experiments.

---

## Objectives

1. **Byteplot Image Representation**: Convert malware binaries into grayscale or RGB byteplots to capture unique structural patterns.
2. **Model Training and Evaluation**: Train and compare multiple **classical ML models** on the transformed malware image datasets.
3. **Class Imbalance Handling**: Assess the impact of class imbalance using three dataset configurations:
   - **Imbalanced Dataset**: Reflects real-world malware distribution, where certain families dominate.
   - **Semi-Balanced Dataset**: Contains a mix of balanced and imbalanced class distributions.
   - **Balanced Dataset**: Ensures equal representation of all malware classes.
4. **Performance Comparison**: Evaluate models using metrics such as **accuracy, precision, recall, F1-score, and AUC**.
5. **Dataset-Based Analysis**: Investigate the effect of dataset properties on model performance and training time.
6. **Graphical Insights**: Use visualizations (heatmaps, confusion matrices, performance plots) to facilitate model interpretation.

---

## Key Features

- **Byteplot Image Processing**: Converts raw malware binaries into structured images.
- **Multiple Classical ML Models**: Implementations of **regression-based, discriminant analysis, and tree-based methods**.
- **Comparison of Model Performance**: Analyzes classifier effectiveness across different datasets.
- **Evaluation Metrics**: Includes **accuracy, precision, recall, F1-score, and AUC** for benchmarking.
- **Dataset Convergence Analysis**: Assesses training convergence and computational efficiency.
- **Visualization Tools**: Generates **heatmaps, box plots, and confusion matrices** for insights.

---

## Directory Structure

```
├── archive/                   # Directory storing the zipped datasets
├── config/                    # Configuration files
│   ├── config.ini             # Global configurations
│   └── dataset_configs.json   # Dataset-specific configurations
├── data/
│   ├── malimg_dataset/        # Malimg dataset       [AUTOGENERATED]
│   ├── malevis_dataset/       # Malevis dataset      [AUTOGENERATED]
│   ├── blended_dataset/       # Blended dataset      [AUTOGENERATED]
├── models/                    # Serialized trained models
│   ├── svm/                   # SVM models          [AUTOGENERATED]
│   ├── lda/                   # LDA models          [AUTOGENERATED]
│   ├── ...                    # Other ML models     [AUTOGENERATED]
├── notebooks/                 # Jupyter notebooks for experimentation
├── notebook_data/             # Intermediate storage for notebook experiments
├── results/
│   ├── malimg/                # Results for Malimg dataset  [AUTOGENERATED]
│   ├── malevis/               # Results for Malevis dataset [AUTOGENERATED]
│   ├── blended/               # Results for blended dataset [AUTOGENERATED]
├── split/
│   ├── malimg_dataset/        # Train/Test/Val splits       [AUTOGENERATED]
│   ├── malevis_dataset/       # Train/Test/Val splits       [AUTOGENERATED]
│   ├── blended_dataset/       # Train/Test/Val splits       [AUTOGENERATED]
├── mcmls/                     
│   ├── comparisons/           # Modules for model comparisons
│   ├── core/                  # Core functions and utilities
│   ├── factory/               # Factory patterns for model instantiation
│   ├── models/                # Machine learning model implementations
│   ├── utils/                 # Helper functions for preprocessing and evaluation
│   └── mcmls.py               # Framework entry point
├── mcmls-cli.py               # Command-line interface for experiments
├── README.md                  # Documentation
└── requirements.txt           # Dependencies
```

---

## Installation

1. **Clone the repository**:
   ```bash
   git clone https://github.com/alessandro-uniroma2/mcmls.git
   ```

2. **Install dependencies**:
   ```bash
   cd mcmls
   pip install -r requirements.txt
   ```

3. **Verify installation**:
   ```bash
   python mcmls-cli.py env check
   ```
   If successful, you should see: `[+] All requirements satisfied.`

4. **Prepare the datasets**:
   ```bash
   python mcmls-cli.py dataset fetch
   python mcmls-cli.py dataset check
   ```
   Ensure at least **20GB** of disk space is available for dataset processing.

---

## Usage

### General Syntax

```bash
python mcmls-cli.py <action> <command> [options]
```

### Actions and Commands

#### Dataset Management

##### Download Datasets:
```bash
python mcmls-cli.py dataset fetch
```
##### Verify Datasets:
```bash
python mcmls-cli.py dataset check
```

#### Model Training & Evaluation

##### Train Models:
```bash
python mcmls-cli.py model train -m <model> -d <dataset>
```
Example: Train **LDA** on **Malimg dataset**:
```bash
python mcmls-cli.py model train -m LDA -d Malimg
```

##### Run Predictions:
```bash
python mcmls-cli.py model run -m <model> -d <dataset>
```
Example: Run **SVM** on **Malevis dataset**:
```bash
python mcmls-cli.py model run -m SVM -d Malevis
```

##### Compare Models:
```bash
python mcmls-cli.py model compare -m <model> -d <dataset>
```
Example: Compare **all models** on the **Blended dataset**:
```bash
python mcmls-cli.py model compare -d blended
```

---

## Results

### Performance Summary

The effectiveness of **classic ML models** is assessed through multiple metrics. The impact of dataset **class imbalance** is analyzed, and models are ranked based on their **F1-score, precision, recall, and AUC**.

### Visualization Highlights

- **Training History**: Tracks accuracy and loss across models.
- **Confusion Matrices**: Displays per-class classification performance.
- **Feature Importance Plots**: Highlights key factors influencing classification.

---

## Future Work

- **Feature Engineering**: Explore additional handcrafted features beyond byteplots.
- **Hybrid Models**: Combine classical ML with deep learning techniques.
- **Dataset Expansion**: Include more diverse malware families.

---

## Contributing

Contributions are welcome! Please **fork the repository** and submit a **pull request**.

---

## License

This project is licensed under the **MIT License**. See the [LICENSE](LICENSE) file for details.

---

## References

* [Pattern Recognition Techniques for Malware Detection](https://arxiv.org/abs/2202.01243)
* [Classic vs Deep Learning for Malware Image Classification](https://arxiv.org/abs/2301.01827)